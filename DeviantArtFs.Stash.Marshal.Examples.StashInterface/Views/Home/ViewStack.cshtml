@model IEnumerable<DeviantArtFs.Stash.Marshal.StashNode>

@{
    ViewData["Title"] = "View Stack";
}

<h2>View Stack</h2>

@foreach (var node in Model)
{
    var meta = node.BclMetadata;
    <div>
        @if (meta.Thumb?.Src != null)
        {
            <img align="left" src="@meta.Thumb.Src" style="max-width: 128px; max-height: 128px" />
        }
        @if (meta.Files != null)
        {
            var smallest = meta.Files
                .Where(f => f.Width * f.Height > 0)
                .OrderBy(f => f.Width * f.Height > 0)
                .FirstOrDefault();
            if (smallest != null)
            {
                <img align="left" src="@smallest.Src" style="max-width: 128px; max-height: 128px" />
            }
        }
        <h3>@meta.Title</h3>
        <p>@(meta.Itemid ?? meta.Stackid)</p>
        @if (meta.Itemid == null)
        {
            <a href="/Home/ViewStack?stackid=@meta.Stackid">View contents</a>
        }
        @if (meta.Files != null)
        {
            <ul>
                @foreach (var f in meta.Files)
                {
                    <li><a href="@f.Src">@f.Src</a></li>
                }
            </ul>
        }
    </div>
    <div style="clear: both"></div>
    <hr />
}